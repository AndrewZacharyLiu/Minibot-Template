ARM GAS  /var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"bsp_serial.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "control-base/bsp/src/bsp_serial.c"
  20              		.section	.text.debug_printf,"ax",%progbits
  21              		.align	1
  22              		.global	debug_printf
  23              		.syntax unified
  24              		.thumb
  25              		.thumb_func
  27              	debug_printf:
  28              	.LVL0:
  29              	.LFB137:
   1:control-base/bsp/src/bsp_serial.c **** #include "bsp_serial.h"
   2:control-base/bsp/src/bsp_serial.c **** 
   3:control-base/bsp/src/bsp_serial.c **** #include "usart.h"
   4:control-base/bsp/src/bsp_serial.c **** #include "stdarg.h"
   5:control-base/bsp/src/bsp_serial.c **** #include "stdio.h"
   6:control-base/bsp/src/bsp_serial.c **** #include "string.h"
   7:control-base/bsp/src/bsp_serial.c **** 
   8:control-base/bsp/src/bsp_serial.c **** #define MAX_STRING_LENGTH 1028
   9:control-base/bsp/src/bsp_serial.c **** 
  10:control-base/bsp/src/bsp_serial.c **** #ifdef DEBUG
  11:control-base/bsp/src/bsp_serial.c **** #define DEBUG_PRINTF(huart, format, ...) debug_printf((huart), (format), ##__VA_ARGS__)
  12:control-base/bsp/src/bsp_serial.c **** #else
  13:control-base/bsp/src/bsp_serial.c **** #define DEBUG_PRINTF(huart, format, ...) ((void)0)
  14:control-base/bsp/src/bsp_serial.c **** #endif
  15:control-base/bsp/src/bsp_serial.c **** char buffer[MAX_STRING_LENGTH];
  16:control-base/bsp/src/bsp_serial.c **** 
  17:control-base/bsp/src/bsp_serial.c **** /**
  18:control-base/bsp/src/bsp_serial.c ****  * @brief Non-blocking printf function using DMA
  19:control-base/bsp/src/bsp_serial.c **** */
  20:control-base/bsp/src/bsp_serial.c **** void debug_printf(UART_HandleTypeDef *huart, const char *format, ...) {
  30              		.loc 1 20 71 view -0
  31              		.cfi_startproc
  32              		@ args = 4, pretend = 12, frame = 8
  33              		@ frame_needed = 0, uses_anonymous_args = 1
  34              		.loc 1 20 71 is_stmt 0 view .LVU1
  35 0000 0EB4     		push	{r1, r2, r3}
  36              	.LCFI0:
  37              		.cfi_def_cfa_offset 12
  38              		.cfi_offset 1, -12
ARM GAS  /var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s 			page 2


  39              		.cfi_offset 2, -8
  40              		.cfi_offset 3, -4
  41 0002 30B5     		push	{r4, r5, lr}
  42              	.LCFI1:
  43              		.cfi_def_cfa_offset 24
  44              		.cfi_offset 4, -24
  45              		.cfi_offset 5, -20
  46              		.cfi_offset 14, -16
  47 0004 82B0     		sub	sp, sp, #8
  48              	.LCFI2:
  49              		.cfi_def_cfa_offset 32
  50 0006 0446     		mov	r4, r0
  51 0008 05AB     		add	r3, sp, #20
  52 000a 53F8042B 		ldr	r2, [r3], #4
  21:control-base/bsp/src/bsp_serial.c ****     va_list args;
  53              		.loc 1 21 5 is_stmt 1 view .LVU2
  22:control-base/bsp/src/bsp_serial.c ****     va_start(args, format);
  54              		.loc 1 22 5 view .LVU3
  55 000e 0193     		str	r3, [sp, #4]
  23:control-base/bsp/src/bsp_serial.c ****     
  24:control-base/bsp/src/bsp_serial.c ****     // Use vsnprintf instead of vsprintf to avoid buffer overflow
  25:control-base/bsp/src/bsp_serial.c ****     vsnprintf(buffer, MAX_STRING_LENGTH, format, args);
  56              		.loc 1 25 5 view .LVU4
  57 0010 0B4D     		ldr	r5, .L4
  58 0012 40F20441 		movw	r1, #1028
  59 0016 2846     		mov	r0, r5
  60              	.LVL1:
  61              		.loc 1 25 5 is_stmt 0 view .LVU5
  62 0018 FFF7FEFF 		bl	vsnprintf
  63              	.LVL2:
  26:control-base/bsp/src/bsp_serial.c ****     va_end(args);
  64              		.loc 1 26 5 is_stmt 1 view .LVU6
  27:control-base/bsp/src/bsp_serial.c ****     
  28:control-base/bsp/src/bsp_serial.c ****     // Send the string over UART using DMA
  29:control-base/bsp/src/bsp_serial.c ****     HAL_UART_Transmit_DMA(huart, (uint8_t*)buffer, strlen(buffer));
  65              		.loc 1 29 5 view .LVU7
  66              		.loc 1 29 52 is_stmt 0 view .LVU8
  67 001c 2846     		mov	r0, r5
  68 001e FFF7FEFF 		bl	strlen
  69              	.LVL3:
  70              		.loc 1 29 5 discriminator 1 view .LVU9
  71 0022 82B2     		uxth	r2, r0
  72 0024 2946     		mov	r1, r5
  73 0026 2046     		mov	r0, r4
  74 0028 FFF7FEFF 		bl	HAL_UART_Transmit_DMA
  75              	.LVL4:
  30:control-base/bsp/src/bsp_serial.c ****     while (__HAL_UART_GET_FLAG(huart, UART_FLAG_TC) == RESET) {
  76              		.loc 1 30 5 is_stmt 1 view .LVU10
  77              	.L2:
  31:control-base/bsp/src/bsp_serial.c ****             // Optionally, insert a timeout mechanism here to break from the loop if needed
  32:control-base/bsp/src/bsp_serial.c ****     }
  78              		.loc 1 32 5 view .LVU11
  30:control-base/bsp/src/bsp_serial.c ****     while (__HAL_UART_GET_FLAG(huart, UART_FLAG_TC) == RESET) {
  79              		.loc 1 30 53 discriminator 1 view .LVU12
  30:control-base/bsp/src/bsp_serial.c ****     while (__HAL_UART_GET_FLAG(huart, UART_FLAG_TC) == RESET) {
  80              		.loc 1 30 12 is_stmt 0 discriminator 1 view .LVU13
  81 002c 2368     		ldr	r3, [r4]
ARM GAS  /var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s 			page 3


  82 002e 1B68     		ldr	r3, [r3]
  30:control-base/bsp/src/bsp_serial.c ****     while (__HAL_UART_GET_FLAG(huart, UART_FLAG_TC) == RESET) {
  83              		.loc 1 30 53 discriminator 1 view .LVU14
  84 0030 13F0400F 		tst	r3, #64
  85 0034 FAD0     		beq	.L2
  33:control-base/bsp/src/bsp_serial.c **** }
  86              		.loc 1 33 1 view .LVU15
  87 0036 02B0     		add	sp, sp, #8
  88              	.LCFI3:
  89              		.cfi_def_cfa_offset 24
  90              		@ sp needed
  91 0038 BDE83040 		pop	{r4, r5, lr}
  92              	.LCFI4:
  93              		.cfi_restore 14
  94              		.cfi_restore 5
  95              		.cfi_restore 4
  96              		.cfi_def_cfa_offset 12
  97              	.LVL5:
  98              		.loc 1 33 1 view .LVU16
  99 003c 03B0     		add	sp, sp, #12
 100              	.LCFI5:
 101              		.cfi_restore 3
 102              		.cfi_restore 2
 103              		.cfi_restore 1
 104              		.cfi_def_cfa_offset 0
 105 003e 7047     		bx	lr
 106              	.L5:
 107              		.align	2
 108              	.L4:
 109 0040 00000000 		.word	buffer
 110              		.cfi_endproc
 111              	.LFE137:
 113              		.section	.text._write,"ax",%progbits
 114              		.align	1
 115              		.global	_write
 116              		.syntax unified
 117              		.thumb
 118              		.thumb_func
 120              	_write:
 121              	.LVL6:
 122              	.LFB138:
  34:control-base/bsp/src/bsp_serial.c **** 
  35:control-base/bsp/src/bsp_serial.c **** /**
  36:control-base/bsp/src/bsp_serial.c ****  * Obsolete function required for printf to work
  37:control-base/bsp/src/bsp_serial.c ****  * this function calls HAL_UART_Transmit, which will block the program 
  38:control-base/bsp/src/bsp_serial.c ****  * until all data is sent.
  39:control-base/bsp/src/bsp_serial.c ****  * @ref debug_printf for a non-blocking version using DMA
  40:control-base/bsp/src/bsp_serial.c **** */
  41:control-base/bsp/src/bsp_serial.c **** int _write(int file, char *ptr, int len) {
 123              		.loc 1 41 42 is_stmt 1 view -0
 124              		.cfi_startproc
 125              		@ args = 0, pretend = 0, frame = 0
 126              		@ frame_needed = 0, uses_anonymous_args = 0
 127              		.loc 1 41 42 is_stmt 0 view .LVU18
 128 0000 10B5     		push	{r4, lr}
 129              	.LCFI6:
 130              		.cfi_def_cfa_offset 8
ARM GAS  /var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s 			page 4


 131              		.cfi_offset 4, -8
 132              		.cfi_offset 14, -4
 133 0002 1446     		mov	r4, r2
  42:control-base/bsp/src/bsp_serial.c ****     HAL_UART_Transmit(&huart6, (uint8_t *)ptr, len, HAL_MAX_DELAY);
 134              		.loc 1 42 5 is_stmt 1 view .LVU19
 135 0004 4FF0FF33 		mov	r3, #-1
 136 0008 92B2     		uxth	r2, r2
 137              	.LVL7:
 138              		.loc 1 42 5 is_stmt 0 view .LVU20
 139 000a 0248     		ldr	r0, .L8
 140              	.LVL8:
 141              		.loc 1 42 5 view .LVU21
 142 000c FFF7FEFF 		bl	HAL_UART_Transmit
 143              	.LVL9:
  43:control-base/bsp/src/bsp_serial.c ****     //while(!huart6.Instance->SR & UART_FLAG_IDLE);
  44:control-base/bsp/src/bsp_serial.c ****     return len;
 144              		.loc 1 44 5 is_stmt 1 view .LVU22
  45:control-base/bsp/src/bsp_serial.c **** }...
 145              		.loc 1 45 1 is_stmt 0 view .LVU23
 146 0010 2046     		mov	r0, r4
 147 0012 10BD     		pop	{r4, pc}
 148              	.LVL10:
 149              	.L9:
 150              		.loc 1 45 1 view .LVU24
 151              		.align	2
 152              	.L8:
 153 0014 00000000 		.word	huart6
 154              		.cfi_endproc
 155              	.LFE138:
 157              		.global	buffer
 158              		.section	.bss.buffer,"aw",%nobits
 159              		.align	2
 162              	buffer:
 163 0000 00000000 		.space	1028
 163      00000000 
 163      00000000 
 163      00000000 
 163      00000000 
 164              		.text
 165              	.Letext0:
 166              		.file 2 "/Applications/ArmGNUToolchain/14.3.rel1/arm-none-eabi/arm-none-eabi/include/machine/_defa
 167              		.file 3 "/Applications/ArmGNUToolchain/14.3.rel1/arm-none-eabi/lib/gcc/arm-none-eabi/14.3.1/includ
 168              		.file 4 "/Applications/ArmGNUToolchain/14.3.rel1/arm-none-eabi/lib/gcc/arm-none-eabi/14.3.1/includ
 169              		.file 5 "/Applications/ArmGNUToolchain/14.3.rel1/arm-none-eabi/arm-none-eabi/include/stdio.h"
 170              		.file 6 "/Applications/ArmGNUToolchain/14.3.rel1/arm-none-eabi/arm-none-eabi/include/sys/_stdint.h
 171              		.file 7 "control-base/typec-board-base/Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f407xx.h"
 172              		.file 8 "control-base/typec-board-base/Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f4xx.h"
 173              		.file 9 "control-base/typec-board-base/Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_def.h"
 174              		.file 10 "control-base/typec-board-base/Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_dma.h"
 175              		.file 11 "control-base/typec-board-base/Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_uart.h"
 176              		.file 12 "control-base/typec-board-base/Core/Inc/usart.h"
 177              		.file 13 "/Applications/ArmGNUToolchain/14.3.rel1/arm-none-eabi/arm-none-eabi/include/string.h"
 178              		.file 14 "<built-in>"
ARM GAS  /var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s 			page 5


DEFINED SYMBOLS
                            *ABS*:00000000 bsp_serial.c
/var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s:21     .text.debug_printf:00000000 $t
/var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s:27     .text.debug_printf:00000000 debug_printf
/var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s:109    .text.debug_printf:00000040 $d
/var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s:162    .bss.buffer:00000000 buffer
/var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s:114    .text._write:00000000 $t
/var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s:120    .text._write:00000000 _write
/var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s:153    .text._write:00000014 $d
/var/folders/sg/pxk9dyzj7jz_x3889hx3b3dw0000gn/T//ccNvOmyI.s:159    .bss.buffer:00000000 $d

UNDEFINED SYMBOLS
vsnprintf
strlen
HAL_UART_Transmit_DMA
HAL_UART_Transmit
huart6
